<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!--- CDN -BOOTSTRAP-JQUERY-FONTAWESOME -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/b8914fb7d2.js" crossorigin="anonymous"></script>
  <!--- CDN -BOOTSTRAP-JQUERY-FONTAWESOME -->
  <link rel="shortcut icon" href="https://assets.sensacine.com.mx/favicon/sensacinemx.ico" type="image/x-icon">
  <link rel="stylesheet" href="css/admin.css">
  <script src="js/print.js" defer></script>
  <script src="js/printarea.js" defer></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
  <title>Administrador</title>
</head>

<body>
  <%- include('a_header') -%>
          <div class="container-fluid" id="print_div">
            <div class="d-flex justify-content-between align-content-center mb-3"> <h1>Dashboards</h1> <button class="btn p-1 btn-cartelera" id="event_click" >Imprimir</button>
            </div>
            <div class="d-flex justify-content-around mb-3">
            <div class="card bg-light mb-3 shadow" style="width: 30rem; max-height: 200px;">
              <div class="card-header">Ingresos:</div>
              <div class="card-body">
                <h4 class="card-text" id="total_a"></h2>
                <h5 class="card-title" id="total_ing"></h3>
               
              </div>
            </div>
            <div class="card bg-light mb-3 shadow" style="width: 30rem;  max-height: 200px;">
              <div class="card-header">Productos vendidos</div>
              <div class="card-body">
                <h4 class="card-text" id="prod_a"></h2>
                  <h5 class="card-title" id="prod_ing"></h3>
              </div>
            </div>
            
            </div>
            <div class="d-flex justify-content-center mb-3">
  
  <div class="card  text-white bg-dark mb-3 shadow" style="max-width: 80%;">
    <div class="card-header">Ventas por mes.</div>
    <div class="card-body">
      <canvas id="myChart1" width="600px" height="200px"></canvas>
    </div>
  </div>
            </div>

            <div class="d-flex justify-content-center mb-3 ">
  <div class="card text-white bg-warning mb-3 mr-3 shadow" style="max-width: 80%;">
    <div class="card-header">Productos por mes.</div>
    <div class="card-body">
      <canvas id="myChart2" width="600px" height="200px"></canvas>
    </div>
  </div>
</div>
<div class="d-flex justify-content-center mb-3 ">
  <div class="card bg-light mb-3 mr-3 shadow" style="max-width: 80%;">
    <div class="card-header">Articulos más vendidos. </div>
    <div class="card-body">
      <canvas id="myChart3" width="600px" height="300px"></canvas>
    </div>
  </div>
  </div>
            </div>

      </div>
      


      <!----cierre del div a_header-->
  </div>
  

  <script>
    var ctx = document.getElementById('myChart1').getContext('2d');
    var ctx2 = document.getElementById('myChart2').getContext('2d');
    var ctx3 = document.getElementById('myChart3').getContext('2d');
    var data = <%- ventas %> ;
    var data2 = <%- articulos %>;
var ene = 0 , feb = 0, mar = 0, abr = 0, may = 0 , jun =0, jul=0,ago=0,sep=0,oct=0,nov=0,dic=0;
var ene2 = 0 , feb2 = 0, mar2 = 0, abr2 = 0, may2 = 0 , jun2 =0, jul2=0,ago2=0,sep2=0,oct2=0,nov2=0,dic2=0;
var date = new Date();
    var month = date.getMonth() + 1;
    var year =   date.getFullYear() ;
for(var i = 0; i < data.length; i++){
if(data[i].fecha.substr(0,4) == year){
  var mes = data[i].fecha.substr(4,2);
if(mes == "1"){
ene = ene + data[i].venta;
ene2 = ene2 + data[i].cantidad;
}
if(mes == "2"){
feb = feb + data[i].venta;
feb2 = feb2 + data[i].cantidad;
}
if(mes == "3"){
mar = mar + data[i].venta;
mar2 = mar2 + data[i].cantidad;
}
if(mes == "4"){
abr = abr + data[i].venta;
abr2 = abr2 + data[i].cantidad;
}
if(mes == "5"){
may = may + data[i].venta;
may2 = may2 + data[i].cantidad;
}
if(mes == "6"){
jun = jun + data[i].venta;
jun2 = jun2 + data[i].cantidad;
}
if(mes == "7"){
jul = jul + data[i].venta;
jul2 = jul2 + data[i].cantidad;
}
if(mes == "8"){
ago = ago + data[i].venta;
ago2 = ago2 + data[i].cantidad;
}
if(mes == "9"){
sep = sep + data[i].venta;
sep2 = sep2 + data[i].cantidad;
}
if(mes == "10"){
oct = oct + data[i].venta;
oct2 = oct2 + data[i].cantidad;
}
if(mes == "11"){
nov = nov + data[i].venta;
nov2 = nov2 + data[i].cantidad;
}
if(mes == "12"){
dic = dic + data[i].venta;
dic2 = dic2 + data[i].cantidad;
}
}
}


$('#total_ing').text( "$ " + (ene + feb + mar + abr + may + jun + jul + ago + sep + oct + nov + dic).toFixed(2));
$('#total_a').text("Año: "+ year);
    var myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul','Ago', 'Sep', 'Oct','Nov','Dic'],
            datasets: [{
                label: 'Número de pesos mexicanos.',
                data: [ene, feb, mar, abr, may, jun,jul,ago,sep,oct,nov,dic],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)',
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)',
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
   
    $('#prod_ing').text(  (ene2 + feb2 + mar2 + abr2 + may2 + jun2 + jul2 + ago2 + sep2 + oct2 + nov2 + dic2) + " vendidos") ;
$('#prod_a').text("Año: "+ year);

    var myChart2 = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul','Ago', 'Sep', 'Oct','Nov','Dic'],
            datasets: [{
              label: 'Número de productos.',
                data: [ene2, feb2, mar2, abr2, may2, jun2,jul2,ago2,sep2,oct2,nov2,dic2],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.9)',
                    'rgba(54, 162, 235, 0.9)',
                    'rgba(255, 206, 86, 0.9)',
                    'rgba(75, 192, 192, 0.9)',
                    'rgba(153, 102, 255, 0.9)',
                    'rgba(255, 159, 64, 0.9)',
                    'rgba(255, 99, 132, 0.9)',
                    'rgba(54, 162, 235, 0.9)',
                    'rgba(255, 206, 86, 0.9)',
                    'rgba(75, 192, 192, 0.9)',
                    'rgba(153, 102, 255, 0.9)',
                    'rgba(255, 159, 64, 0.9)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)',
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        
    });

    var productos = [];
    var cant = [];
    var idp = [];

  for(var i = 0; i < data2.length ; i++){
        productos.push(data2[i].producto);
      }
  for(var i = 0; i < data2.length ; i++){
    idp.push(data2[i]._id);
  } 
   for(var i = 0; i < idp.length ; i++){
     var contenedor = 0;
   for(var j = 0; j < data.length; j++){
     if(idp[i] === data[j].idproducto ){
       contenedor = contenedor + data[j].cantidad;
     }
   }
     cant.push(contenedor);   
    }   
    
    

    var myChart3 = new Chart(ctx3, {
        type: 'pie',
        data: {
            labels: productos,
            datasets: [{
                label: 'Número de pesos mexicanos.',
                data: cant,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)',
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)',
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
 
    });

    </script>
  
</body>

</html>